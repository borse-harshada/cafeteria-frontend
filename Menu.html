<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafeteria Menu</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Montserrat', sans-serif; 
            background: #fff; 
            color: #000; 
            overflow-x: hidden;
        }
        h1,h2,h3,h4,h5 { font-family: 'Cormorant Garamond', serif; font-weight: 600; }

        .container { max-width: 1200px; margin: auto; padding: 0 20px; }
        .section-padding { padding: 70px 0; }

        .header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar { padding: 0.5em 2em; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .nav-menu { display: flex; list-style: none; }
        .nav-item { margin-left: 30px; }
        .nav-link { text-decoration: none; color: #000; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: #ffe711; }

        .cart-icon { position: relative; cursor: pointer; }
        .cart-count {
            background: #ffe711; color: #000;
            position: absolute; top: -8px; right: -10px;
            width: 20px; height: 20px;
            border-radius: 50%;
            font-size: 12px; display: flex; align-items: center; justify-content: center;
        }

        .hamburger { display: none; cursor: pointer; }
        .bar { width: 25px; height: 3px; background: #000; margin: 5px auto; }

        .page-hero {
            height: 45vh;
            background: linear-gradient(#fff,rgba(255,255,255,0.9)), url('./assets/images/hero.jpg') center/cover;
            display: flex; justify-content: center; align-items: center;
            text-align: center; padding-top: 80px;
        }
        .page-hero h1 { font-size: 3rem; }

        .menu-categories {
            display: flex; justify-content: center; flex-wrap: wrap;
            gap: 15px; padding: 25px 0; background: #fff;
            position: sticky; top: 80px; z-index: 999;
        }
        .category-link {
            padding: 10px 24px; 
            border-radius: 25px;
            background: #fff; border: 1px solid #ddd;
            text-decoration: none; color: #000;
            transition: 0.3s;
        }
        .category-link:hover, .category-link.active {
            background: #ffe711;
        }

        .menu-grid {
            display: grid; gap: 25px;
            grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
        }
        .menu-item {
            background: #fff; border-radius: 10px;
            overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: 0.3s;
        }
        .menu-item:hover { transform: translateY(-6px); }

        .item-image {
            height: 190px; overflow: hidden;
        }
        .item-image img {
            width: 100%; height: 100%; object-fit: cover;
            transition: 0.3s;
        }
        .menu-item:hover .item-image img { transform: scale(1.07); }

        .item-info { padding: 15px; }
        .item-meta { display: flex; justify-content: space-between; margin-top: 10px; }
        .item-price { font-size: 1.2rem; color: #ffe711; font-weight: bold; }

        .item-actions { display: flex; gap: 10px; }
        .btn-add, .btn-buy {
            padding: 7px 15px; cursor: pointer; border-radius: 4px;
            border: 1px solid #000; background: transparent; transition: 0.3s;
        }
        .btn-buy { background: #ffe711; border: none; }
        .btn-add:hover { background: #000; color: #fff; }
        .btn-buy:hover { background: #e0c600; }
    </style>
</head>

<body>

<header class="header">
    <nav class="navbar">
        <div class="nav-container">
            <a href="/home.html"><img src="./assets/images/logo.svg" width="130"></a>

            <ul class="nav-menu">
                <li class="nav-item"><a href="/index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a class="nav-link active">Menu</a></li>
                <li class="nav-item">
                    <a class="nav-link cart-icon"><i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                </li>
            </ul>

            <div class="hamburger">
                <span class="bar"></span><span class="bar"></span><span class="bar"></span>
            </div>
        </div>
    </nav>
</header>

<section class="page-hero">
    <h1>Our Menu</h1>
</section>

<section class="menu-nav">
    <div class="menu-categories">
        <a href="#lunch" class="category-link">Lunch</a>
        <a href="#snacks" class="category-link">Snacks</a>
        <a href="#drinks" class="category-link">Drinks</a>
        <a href="#desserts" class="category-link">Desserts</a>
        <a href="#specials" class="category-link">Special Dishes</a>
    </div>
</section>

<!-- ================= LUNCH SECTION ================= -->
<section id="lunch" class="menu-section section-padding">
    <div class="container">
        <h2 class="section-title">Lunch</h2>

        <div class="menu-grid" id="lunch-grid">

            <!-- STATIC ITEMS (you can remove if you want pure dynamic) -->
            <div class="menu-item">
                <div class="item-image">
                    <img src="./assets/images/bf1.jpg">
                </div>
                <div class="item-info">
                    <h3>Dal Rice</h3>
                    <div class="item-meta">
                        <span class="item-price">50Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="Dal Rice" data-price="50">Add</button>
                            <button class="btn-buy" data-name="Dal Rice" data-price="50">Buy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= SNACKS SECTION ================= -->
<section id="snacks" class="menu-section section-padding">
    <div class="container">
        <h2 class="section-title">Snacks</h2>

        <div class="menu-grid" id="snacks-grid">

            <div class="menu-item">
                <div class="item-image"><img src="./assets/images/snx1.jpg"></div>
                <div class="item-info">
                    <h3>Samosa</h3>
                    <div class="item-meta">
                        <span class="item-price">15Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="Samosa" data-price="15">Add</button>
                            <button class="btn-buy" data-name="Samosa" data-price="15">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<!-- ================= DRINKS SECTION ================= -->
<section id="drinks" class="menu-section section-padding">
    <div class="container">
        <h2 class="section-title">Drinks</h2>

        <div class="menu-grid" id="drinks-grid">

            <div class="menu-item">
                <div class="item-image"><img src="./assets/images/drk1.jpg"></div>
                <div class="item-info">
                    <h3>Sprite</h3>
                    <div class="item-meta">
                        <span class="item-price">15Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="Sprite" data-price="15">Add</button>
                            <button class="btn-buy" data-name="Sprite" data-price="15">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<!-- ================= DESSERTS SECTION ================= -->
<section id="desserts" class="menu-section section-padding">
    <div class="container">
        <h2 class="section-title">Desserts</h2>

        <div class="menu-grid" id="desserts-grid">

            <div class="menu-item">
                <div class="item-image"><img src="./assets/images/dest3.jpg"></div>
                <div class="item-info">
                    <h3>Mithai</h3>
                    <div class="item-meta">
                        <span class="item-price">30Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="Mithai" data-price="30">Add</button>
                            <button class="btn-buy" data-name="Mithai" data-price="30">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</section>


<!-- ================= SPECIAL DISHES SECTION ================= -->
<section id="specials" class="menu-section section-padding">
    <div class="container">
        <h2 class="section-title">Special Dishes</h2>

        <div class="menu-grid" id="specials-grid">

            <div class="menu-item">
                <div class="item-image"><img src="./assets/images/spc1.jpg"></div>
                <div class="item-info">
                    <h3>Dosa</h3>
                    <div class="item-meta">
                        <span class="item-price">70Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="Dosa" data-price="70">Add</button>
                            <button class="btn-buy" data-name="Dosa" data-price="70">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</section>


<!-- ================= CART MODAL ================= -->
<div class="cart-modal">
    <div class="cart-modal-content">
        <h2>Your Cart</h2>

        <div class="cart-items"></div>

        <div class="cart-total">
            <span>Total:</span>
            <span class="cart-total-price">0Rs</span>
        </div>

        <div class="cart-buttons">
            <button class="btn btn-primary" id="orderNowBtn">Order Now</button>
            <button class="btn btn-secondary cart-close">Close</button>
        </div>
    </div>
</div>
<script>
/* ===========================
   LOAD MENU ITEMS FROM BACKEND
=========================== */

async function loadMenuItems() {
    try {
        const res = await fetch("https://cafeteria-backend-ddq8.onrender.com/api/menu/all");
        const data = await res.json();

        if (!data.success || !Array.isArray(data.data)) {
            console.error("Invalid backend response:", data);
            return;
        }

        const items = data.data;

        items.forEach(item => {
            const section = document.querySelector(`#${item.category} .menu-grid`);
            if (!section) return;

            const card = document.createElement("div");
            card.classList.add("menu-item");

            card.innerHTML = `
                <div class="item-image">
                    <img src="${item.image}">
                </div>
                <div class="item-info">
                    <h3>${item.name}</h3>
                    <div class="item-meta">
                        <span class="item-price">${item.price}Rs</span>
                        <div class="item-actions">
                            <button class="btn-add" data-name="${item.name}" data-price="${item.price}">Add</button>
                            <button class="btn-buy" data-name="${item.name}" data-price="${item.price}">Buy</button>
                        </div>
                    </div>
                </div>
            `;

            section.appendChild(card);
        });

        console.log("Menu updated from backend:", items);

    } catch (error) {
        console.error("Error loading backend menu:", error);
    }
}

document.addEventListener("DOMContentLoaded", loadMenuItems);


/* ===========================
   ORDER NOW — SEND ORDER TO BACKEND
=========================== */

document.addEventListener("DOMContentLoaded", () => {
    const orderNowBtn = document.getElementById("orderNowBtn");
    let orderProcessing = false;

    orderNowBtn.addEventListener("click", async () => {
        if (orderProcessing) return;   // ❌ Prevent double orders
        orderProcessing = true;

        if (cart.length === 0) {
            alert("Your cart is empty!");
            orderProcessing = false;
            return;
        }

        const customerName = localStorage.getItem("studentName");
        const phone = localStorage.getItem("studentPhone");

        if (!customerName || !phone) {
            alert("Please login first!");
            window.location.href = "/login.html";
            return;
        }

        const orderData = {
            customerName,
            phone,
            items: cart.map(item => ({
                name: item.name,
                quantity: item.quantity,
                price: item.price
            })),
            total: cart.reduce((sum, i) => sum + (i.price * i.quantity), 0)
        };

        try {
            const res = await fetch("https://cafeteria-backend-ddq8.onrender.com/api/orders/place", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(orderData)
            });

            if (res.ok) {
                alert("Order placed successfully!");
                cart = [];
                updateCart();
                closeCart();
            } else {
                alert("Error placing order.");
            }

        } catch (err) {
            console.error(err);
            alert("Server error.");
        }

        orderProcessing = false;
    });
});
</script>

<!-- Main cart & menu scripts -->
<script type="module" src="./assets/js/script.js"></script>
<script src="./assets/js/menu.js"></script>

</body>
</html>
